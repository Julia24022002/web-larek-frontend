# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Документация

### Данные и типы данных, используемые в приложении

- Интерфейс данных для товара

```typescript
interface IProduct {
	id: string; // уникальный id
	category: string; // категория товара
	title: string; // название  товара
	image: string; // ссылка на изображение товара
	price: number | null; // цена товара, может быть null
	description?: string; // описание товара
}
```

- интерфейс, описывающий данные о способе оплаты и доставке заказа

```typescript
interface IPaymentForm {
	payment: TPayment; // Способ оплаты
	address: string; // Адрес доставки
}
```

- Интерфейс, описывающий контактные данные заказчика

```typescript
interface IContactForm {
	email: string; // электронная почта
	phone: string; // номер телефона
}
```

- Интерфейс, описывающий корзину товара

```typescript
interface IBasket {
	items: HTMLElement[]; // массив карточек товаров
	total: number; // общая стоимость
	emptyCheck: boolean; // пуста корзина или нет
}
```

- Тип успешного ответа от сервера при отправке заказа

```typescript
type TOrderResult = { id: string; total: number };
```

- Тип описывающий категории товаров

```typescript
type TCategoryType =
	| 'софт-скил'
	| 'другое'
	| 'дополнительное'
	| 'кнопка'
	| 'хард-скил';
```

- Тип способа оплаты

```typescript
type TPayment = 'cash' | 'card';
```

- Тип для ошибок формы

```typescript
type TFormErrors = Partial<Record<keyof IOrderData, string>>;
```

- Тип для товара в корзине

```typescript
type TProductInBasket = Pick<IProduct, 'id' | 'title' | 'price'> & {
	index: number;
};
```

### Архитекрута приложения

Код приложения разделен на слои слогласно парадигме `MVP`:

- `Model`слой данных, отвечает за хранение и изменение данных.
- `View` слой представления, отвечает за отображения данных на странице.
- `Presenter` презентер, отвечает за связь представления и данных (src/index.ts)

### Базовый код

#### Класс `Api`

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный обьект с заголовками запросов.

Поля:

- `baseUrl` - базовый адрес сервера
- `options` - объект с заголовками запросов

Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с обьектом, которым ответил сервер.
- `post`- принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию
  выполняется POST" запрос, но метод запроса может быть переопределен заданием третьего
  параметра при вызове.

#### Класс `EventEmitter`

Брокер событий позволяет отправлять события и подписываться на события, происходящие в
системе. Класс используется в презентере для обработки событий и в слоях приложения для
генерации событий.

Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `events` - переменная к которую будут кэшироваться события.
- `on()` - функция установки обработчика на событие.
- `off()` - функция снятия обработчика с события.
- `emit()` - функция инициирования события с данными.
- `onAll` - функция прослушивания всех событий.
- `offAll` - функция сброса всех обработчиков.
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

#### Абстрактный класс `Component`

Абстрактный базовый класс предназначен для создания компонентов пользовательского интерфейса. Класс обеспечивает инструментарий для управления DOM элементами и поведением компонента. Наследуется всеми классами представления(View)

Поля:

- `protected _container: HTMLElement` - DOM элемент, передаваемый в конструкторе
- `protected events: IEvents` - объект класса EventEmitter для инициации событий при изменении данных.

Параметры в конструкторе:

- `container: HTMLElement` - DOM элемент компонента
- `events: IEvents` - объект класса EventEmitter для инициации событий при изменении данных.

Методы, геттеры и сеттеры:

- `render(data?: Partial<T>): HTMLElement` - возвращает отрисованный html элемент по переданным данным

#### Абстрактный класс `Model`

Абстрактный класс Model служит шаблоном для классов слоя данных.

Поля:

- `protected events: IEvents` - объект класса EventEmitter для инициации событий при изменении данных.

Конструктор:

- `events: IEvents` - объект класса EventEmitter для инициации событий при изменении данных.

## Слой данных (Model)

#### Класс `ProductData`

Класс отвечает за хранение и логику работы с данными товаров.

Поля:

- `protected _products: IProduct[] `- массив объектов товаров.
- `protected _preview: string | null` - id товара, выбранной для просмотра в модальном окне

Параметры в конструкторе:

- `параметры Model`

Методы, геттеры и сеттеры:

- `getProduct(id: string): IProduct` - находит товар по id и возвращает его.
- `get products(): IProduct[]` - возвращает массив продуктов \_products
- `set products(value: IProduct[]): void` - записывает массив продуктов в \_products
- `set preview(productId: string | null)` - Записывает в поле \_preview выбранный товар для показа в модальном окне
- `get preview()` - Получение ID выбранного товара для просмотра в модальном окне

#### Класс `OrderData`

Отвечает за хранение и логику работы с данными при оформлении заказа (выбор способа оплаты, адрес доставки, email и телефон покупателя).
Поля:

- `_order: IOrderData` - все данные заказа
- `formErrors: FormErrors = {} `- массив с текстом ошибок форм.
  Конструктор:
- Параметры `-`
  Методы:
- `get order() `- получить все данные заказа
- `clearOrderData(): void` - очищает массив данных после заказа
- `setOrderField(field: keyof IOrderForm, value: string) `- записывает данные с полей форм в массив данных заказа \_order
- `validateOrder() `- валидация форм

#### Класс `BasketData`

Отвечает за хранение и логику работы с данными о товарах, находящихся в корзине.

Поля:

- `protected _productInBasket: IProduct[]` - массив добавленных товаров в корзине покупателя.

Параметры в конструкторе:

- `параметры Model.`

Методы, геттеры и сеттеры:

- `addProduct(product: TProductInBasket): void `- добавление товара в корзину
- `deleteProduct(id: string): void` - удаление товара из корзины
- `getTotalPrice(): number` - получить сумму всех товаров, добавленных в корзину
- `getTotalProducts(): number;` - получить общее количество добавленных товаров в корзину
- `checkProduct(id: string): boolean;` - определяет по id, есть ли данный товар уже в корзине
- `clearBasket(): void` - очищает корзину

## Слой представления (View)

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных

### "Общие" классы представления

#### Класс `Modal`

Класс для работы с модальными окнами, наследуется от класса Component (реализация слоя View). Класс используется для управления состоянием (открыт, закрыт) и отображением компонента (render) модального окна.

Поля класса:

- `_closeButton: HTMLButtonElement` - кнопка закрытия
- `_content: HTMLElement` - контент модального окна

Методы:

- `set content(value: HTMLElement)` - устанавливает разметку модального окна
- `open(): void` - метод отображения модального окна
- `close(): void`- метод для закрытия модального окна.

#### Класс `Basket`

Класс для работы с корзиной, наследуется от класса Component (реализация слоя View). Класс используется для управления отображением данных (товаров, цены) в компоненте корзины

Поля класса содержат DOM элементы темплейта:

- `protected _products: HTMLUListElement `- html элемент, отвечающий за отображение списка карточек в корзине
- `protected _getTotalPrice: HTMLElement` - html элемент, отвечающий за отображение общей стоимости товаров
- `protected _button: HTMLElement` - кнопка "Оформить".

Параметры в конструкторе:

- `параметры класса Component.`

Методы, геттеры и сеттеры:

- `set products(items: HTMLElement[]): void` - устанавливает список карточек добавленных товаров в корзину
- `set total(total: number) `- устанавливает общую стоимость товаров в html элемент \_totalPrice.
- `toggleButton(state: boolean): void `- для блокировки кнопки "Оформить", если корзина пуста

#### Класс `Form`

Расширяет класс Component<T>. Отвечает за отображение элементов формы.

Поля:

- `protected submitButton: HTMLButtonElement` - кнопка отправки формы
- `protected _errorMessage: HTMLSpanElement` - html элемент для отображения ошибок формы.

Параметры в конструкторе: -`параметры Component.`

Методы, геттеры и сеттеры:

- `get valid(): boolean `- получения статуса валидности формы
- `set valid(value: boolean):void` - запись для блокировки (true) / разблокировки (false) кнопки submit
- `set errorMessage(value: string)`- установка текста ошибок
- `clear():void` - очистка формы
- `render()` - метод рендер для формы

#### Класс `PaymentForm`

Расширяет класс `Form`. Форма для указания способа доставки и адреса доставки.

Поля:

- `protected _payment: HTMLButtonElement[] `- выбор способа оплаты
- `protected _address: HTMLInputElement` - поле ввода адреса

Параметры в конструкторе:

- `параметры Form.`

Методы, геттеры и сеттеры:

- `set paymentSelected(name: string)` - вешается класс на кнопку выбранного способа оплаты и инициализируется - событие куда передается выбранный способ оплаты.
- `paymentSelectedRemove()` - удаляет класс с активной кнопки после заказа\
- `set address(value: string)` - записывает адрес в поле \_address

#### Класс `ContactForm`

Расширяет класс `Form`. Форма для указания телефона и email покупателя.

Поля

- `protected _email: HTMLInputElement` - текстовое поле для email
- `protected _phone: HTMLInputElement` - текстовое поле для номера телефона.

Параметры в конструкторе:

- `параметры Form.`

Методы, геттеры и сеттеры:

- `set email(value: string)` - записывает email в поле \_email
- `set phone(value: string)` - записывает телефон в поле \_phone

#### Класс `Success`

Расширяет класс Component<T>. Отвечает за отображение модального окна успешного заказа.

Поля

- `protected _total: HTMLElement` - общая сумма заказа

- `protected button: HTMLElement` - кнопка закрытия

Параметры в конструкторе:

- `параметры Component`

Методы, геттеры и сеттеры:

- `set total(value: number)` - заполняет общую сумму заказа

#### Классы представлений конкретного проекта:

#### Класс `Page`

Расширяет класс Component. За основной контейнер берет главную страницу приложения. Служит для отображения корзины в шапке сайта и показа количества добавленного товара в ней, также данный класс служит за отображение блока с карточками товаров.

Поля:

- `protected _catalog: HTMLElement` - контейнер для отображения карточек товаров
- `protected buttonBasket: HTMLButtonElement` - иконка(кнопка), по нажатию на которую открывается модальное окно с корзиной
- `protected _counter: HTMLSpanElement` - html элемент, показывающий количество добавленных товаров в корзину
- `protected screen: HTMLDivElement `- html элемент, отвечающий за внутренннее содержимое страницы(экран).

Параметры в конструкторе:

- `параметры класса Component.`

Методы, геттеры и сеттеры:

- `set catalog(cards: HTMLElement[]): void` - записывает карточки в \_catalog для отображения их на главной странице
- `set counter(value: number): void `- записывает количество добавленных товаров в корзину
- `set locked(value: boolean): void` - данный метод служит для блокировки/разблокировки экрана(окна), чтоб не было его прокрутки при открытии/закрытии модального окна.

#### Класс `Card`

Расширяет класс Component<T>. Служит для отображения карточки в каталоге на главной странице приложения.

Поля:

- `protected _id: string` - id карточки товара
- `protected _title: HTMLHeadingElement` - html элемент, отвечающий за отображение имени товара
- `protected _price: HTMLSpanElement `- html элемент, отвечающий за отображение цены товара.
- `protected _image: HTMLImageElement` - html элемент, отвечающий за отображение изображения товара
- `protected _category: HTMLSpanElement` - html элемент, отвечающий за отображение категории товара.

Методы:

- `set id(value: string): void` - запись id карточки товара
- `get id(): string` - получение id карточки товара
- `set title(value: string): void` - запись имени карточки товара
- `set price(value: string): void `- запись цены товара
- `set image(src: string): void` - запись данных изображения товара
- `set category(value: string): void` - запись данных категории товара




#### Класс `CardPreview`

Подкласс класса Card. Служит для предварительного просмотра карточки товара с более детальным описанием и возможностью добавления его в корзину.

Поля:

- `_index: HTMLSpanElement `- html элемент, отвечающий за отображение порядкового номера.

- `protected _description: HTMLParagraphElement `- html элемент, отвечающий за отображение описания товара.


Методы, геттеры и сеттеры:

- `set index(value: number): void `- записывает порядковый номер карточки.

- `set description(value: string): void `- записвает описание товара


## слой коммуникации

#### Класс `ProductAPI`

Расширяет класс Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

Поля

- `protected cdn: string` - базовый путь до изображений карточек, передаваемый в конструкторе.

Параметры в конструкторе:

- `параметры Api`
- `cdn: string` - базовый путь до изображений карточек.

Методы, геттеры и сеттеры:

- `getProduct(id: string): Promise<IProduct[]>` - Метод для получения списка товаров
- `getProductItem(id: string): Promise<IProduct> `- получает с сервера конкретный товар по id

## Взаимодействие компонетов (Presenter)

Код, описывающий взаимодействие представления и данных между собой находится в файле index.ts, выполняющем роль презентера.
Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в index.ts В index.ts сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

## Описание событий
g 