# Проектная работа "Веб-ларек"

## Описание

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Документация

### Данные и типы данных, используемые в приложении

- Интерфейс данных для товара

```typescript
interface IProduct {
	id: string; // уникальный id
	category: TCategoryType; // категория товара
	title: string; // название  товара
	image: string; // ссылка на изображение товара
	price: number | null; // цена товара, может быть null
	description?: string; // описание товара
	inBasket?: boolean; // добавлен товар в корзину
}
```

- Интерфейс данных заказа

```typescript
interface IOrder {
	payment: TPayment; // Способ оплаты
	address: string; // Адрес доставки
	email: string; // Электронная почта
	phone: string; // Телефон
}
```

- Данные для корзины с товарами

```typescript
interface IBasket {
	items: TProductInBasket[]; // список товаров
	total: number; // стоимость заказа
}
```

- Данные успешного ответа от сервера при отправке заказа

```typescript
interface IOrderResult {
	id: string;
	total: number;
}
```

- Тип описывающий категории товаров

```typescript
type TCategoryType =
	| 'софт-скил'
	| 'другое'
	| 'дополнительное'
	| 'кнопка'
	| 'хард-скил';
```

- Тип для товара в корзине

```typescript
type TCardBasket = Pick<IProduct, 'id' | 'title' | 'price'> & { index: number };
```

- Тип способа оплаты

```typescript
type TPayment = 'cash' | 'card';
```

- Тип модального окна выбора способа оплаты и ввода адреса

```typescript
type TDeliveryInfo = Pick<IOrder, 'payment' | 'address'>;
```

- Тип модального окна ввод почты и телефона

```typescript
type TContactsInfo = Pick<IOrder, 'email' | 'phone'>;
```

- Тип для общей суммы заказа

```typescript
type TTotalPrice = Pick<IBasket, 'total'>;
```

### Архитекрута приложения

Код приложения разделен на слои слогласно парадигме `MVP`:

- `Model`слой данных, отвечает за хранение и изменение данных.
- `View` слой представления, отвечает за отображения данных на странице.
- `Presenter` презентер, отвечает за связь представления и данных (src/index.ts)

### Базовый код

#### Класс `Api`

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный обьект с заголовками запросов.

Поля:

- `baseUrl` - базовый адрес сервера
- `options` - объект с заголовками запросов

Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с обьектом, которым ответил сервер.
- `post`- принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию
  выполняется POST" запрос, но метод запроса может быть переопределен заданием третьего
  параметра при вызове.

#### Класс `EventEmitter`

Брокер событий позволяет отправлять события и подписываться на события, происходящие в
системе. Класс используется в презентере для обработки событий и в слоях приложения для
генерации событий.

Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `events` - переменная к которую будут кэшироваться события.
- `on()` - функция установки обработчика на событие.
- `off()` - функция снятия обработчика с события.
- `emit()` - функция инициирования события с данными.
- `onAll` - функция прослушивания всех событий.
- `offAll` - функция сброса всех обработчиков.
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

#### Абстрактный класс `Component`

Абстрактный базовый класс предназначен для создания компонентов пользовательского интерфейса. Класс обеспечивает инструментарий для управления DOM элементами и поведением компонента. Наследуется всеми классами представления(View)

`constructor(container: HTMLElement)`- принимает принимает родительский элемент.

Методы:

- `toggleClass` - переключает класс для переданного элемента.
- `setText` - устанавливает текстовое содержимое для переданного элемента.
- `setImage` - устанавливает изображения и альтернативный текст для изоображения для переданного элемента типа HTMLImageElement
- `setDisabled` - изменяет статус блокировки для переданного элемента.
- `setHidden` - скрывает переданный элемент.
- `setVisible` - отоброжает переданный элемент.
- `render` - рендерит компонент, используя переданные данные. Метод должен быть переназначен в дочерних классах.

#### Абстрактный класс `Model`

Абстрактный класс Model служит шаблоном для классов слоя данных.

Поля:

- `protected events: IEvents` - объект класса EventEmitter для инициации событий при изменении данных.

Конструктор:

- `events: IEvents` - объект класса EventEmitter для инициации событий при изменении данных.

## Слой данных (Model)

#### Класс `ProductData`

Класс отвечает за хранение и логику работы с данными товаров.

Поля:

- `protected _products: IProduct[]` - массив объектов товаров
- `protected _preview: string | null` - id товара, выбранной для просмотра в модальном окне

Конструктор:

```typescript
constructor(products: IProduct[], preview: string | null) {
    this._products = products;
    this._preview = preview;
}
```

Методы:

- `getProduct(productId: string): IProduct;` - Получение товара по ID

- `get products(): IProduct[]` - Получение всех продуктов

- `set preview(productId: string | null)` - Записывает в поле \_preview выбранный товар для показа в модальном окне

- `get preview()` - Получение ID выбранного товара для просмотра в модальном окне

#### Класс `OrderData`

Отвечает за хранение и логику работы с данными при оформлении заказа (выбор способа оплаты, адрес доставки, email и телефон покупателя).

Поля:

- `_order: IOrderData` - все данные заказа
- `formErrors: FormErrors = {} `- массив с текстом ошибок форм.

Конструктор:

- Параметры `-`

Методы:

- `get order() `- получить все данные заказа
- `setProducts(items: string[])` - записывает в массив id товаров в заказе.
- `setTotalPrice(value: number) `- записывает общую цену заказа
- `clearOrderData(): void` - очищает массив данных после заказа
- `setOrderField(field: keyof IOrderForm, value: string) `- записывает данные с полей форм в массив данных заказа \_order
- `validateOrder() `- валидация форм

#### Класс `BasketData`

Отвечает за хранение и логику работы с данными о товарах, находящихся в корзине.

Поля:

- `protected _productsInBasket: IProduct[]` -массив добавленных товаров в корзине

Kонструктор:

Методы:

- `addProduct(product: TProductInBasket): void `- добавление товара в корзину

- `deleteProduct(id: string): void` - удаление товара из корзины

- `getTotalPrice(): number` - получить сумму всех товаров, добавленных в корзину

- `getTotalProducts(): number;` - получить общее количество добавленных товаров в корзину

- `checkProduct(id: string): boolean;` - определяет по id, есть ли данный товар уже в корзине

- `clearBasket(): void` - очищает корзину

## Слой представления (View)

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных

### "Общие" классы представления

#### Класс `Modal`

Класс для работы с модальными окнами, наследуется от класса Component (реализация слоя View). Класс используется для управления состоянием (открыт, закрыт) и отображением компонента (render) модального окна.

Поля класса:

- `_closeButton: HTMLButtonElement` - кнопка закрытия
- `_content: HTMLElement` - контент модального окна

Методы:

- `set content(value: HTMLElement)` - устанавливает разметку модального окна
- `open(): void` - метод отображения модального окна
- `close(): void`- метод для закрытия модального окна.

#### Класс `Basket`

Класс для работы с корзиной, наследуется от класса Component (реализация слоя View). Класс используется для управления отображением данных (товаров, цены) в компоненте корзины

Поля класса содержат DOM элементы темплейта:

- `protected _products: HTMLElement` - контейнер для размещения продуктов
- `protected _getTotalPrice: HTMLElement` - общая сумма товаров
- `protected _button: HTMLElement` - кнопка

Методы:

- `set products(items: HTMLElement[])` - записывает товары в корзину, выводит сообщение 'Корзина пуста' если товаров в корзине нет
- `set total(total: number)` - записывает общую сумму товаров в корзине
- `toggleButton(state: boolean)` - вспомогательный метод который переключает состояние кнопки

#### Класс `Form`

Расширяет класс Component<T>. Отвечает за отображение элементов формы.

Конструктор:

Поля:

- `protected submitButton: HTMLButtonElement` - кнопка отправки формы
- `protected _errorMessage: HTMLSpanElement` - DOM элемент ошибок

Методы: -`protected onInputChange(field: keyof T, value: string)` - вешает каждому полю ввода свое событие

- `set valid(value: boolean)` - разблокирует или блокирует кнопку отправки
- `set errors(value: string)` - записывает ошибки валидации
- `render(state: Partial<T> & IFormState)` - рендер формы

#### Класс `OrderForm`

Расширяет класс `Form`. Отвечает за отображение окон заказа.

Поля:

- `protected _payment: HTMLButtonElement[] `- выбор способа оплаты
- `protected _phone: HTMLInputElement` - поле ввода телефона
- `protected _email: HTMLInputElement` - поле ввода email
- `protected _address: HTMLInputElement` - поле ввода адреса

Методы:

- `set paymentSelected(name: string)` - вешается класс на кнопку выбранного способа оплаты и инициализируется - событие куда передается выбранный способ оплаты.
- `paymentSelectedRemove()` - удаляет класс с активной кнопки после заказа\
- `set phone(value: string)` - записывает телефон в поле \_phone
- `set email(value: string)` - записывает email в поле \_email
- `set address(value: string)` - записывает адрес в поле \_address

#### Класс `Success`

Расширяет класс Component<T>. Отвечает за отображение модального окна успешного заказа.

Поля:

- `protected _total: HTMLElement` - общая сумма заказа
- `protected button: HTMLElement` - кнопка закрытия

Методы:

- `set total(value: number)` - заполняет общую сумму заказа

#### Классы представлений конкретного проекта:

#### Класс `Page`

Расширяет класс Component. За основной контейнер берет главную страницу приложения. Служит для отображения корзины в шапке сайта и показа количества добавленного товара в ней, также данный класс служит за отображение блока с карточками товаров.

Поля:

- `protected _catalog: HTMLElement `- контейнер для отображения карточек товаров
- `protected buttonBasket: HTMLButtonElement `- иконка(кнопка), по нажатию на которую открывается модальное окно с корзиной
- `protected _counter: HTMLSpanElement` - html элемент, показывающий количество добавленных товаров в корзину
- `protected screen: HTMLDivElement `- html элемент, отвечающий за внутренннее содержимое страницы(экран).

Методы:

- `set catalog(cards: HTMLElement[]): void `- записывает карточки в \_catalog для отображения их на главной странице
- `set counter(value: string): void` - записывает количество добавленных товаров в корзину
- `lockScreen(value: boolean): void `- данный метод служит для блокировки/разблокировки экрана(окна), чтоб не было его прокрутки при открытии/закрытии модального окна.

#### Класс `Card`

Расширяет класс Component. Является абстрактным классом, имеющий общие поля у трех разновидностей карточек в приложении: карточка в каталоге на главной странице (CardCatalog), карточка подробного описания товара в модальном окне (CardPreview) и карточка товара в корзине (CardBasket).

Поля:

- `protected _id: string` - id карточки товара
- `protected _title: HTMLHeadingElement` - html элемент, отвечающий за отображение имени товара
- `protected _price: HTMLSpanElement `- html элемент, отвечающий за отображение цены товара.

Методы:

- `set id(value: string): void` - запись id карточки товара
- `get id(): string` - получение id карточки товара
- `set title(value: string): void` - запись имени карточки товара
- `get title(): string` - получение имени карточки товара
- `set price(value: string): void `- запись цены товара
- `get price(): string `- получение цены товара.

#### Класс ` CardCatalog`

Расширяет класс Card, также является классом дженериком. Служит для отображения карточки в каталоге на главной странице приложения.

Поля:

- `protected _image: HTMLImageElement` - html элемент, отвечающий за отображение изображения товара
- `protected _category: HTMLSpanElement` - html элемент, отвечающий за отображение категории товара.

Методы:

- `protected addCSSClassCategory(value: string): void `- служебный метод, предназначенный для присваивания определенного css класса html элементу категории товара в зависимости от ее названия (установка фонового цвета)
- `set image(src: string): void` - запись данных изображения товара
- `set category(value: string): void` - запись данных категории товара
- `get category(): string `- получение названия категории товара.

#### Класс `CardBasket`

Расширяет класс Card. Служит для отображения карточки товара в корзине

Поля:

- `_index: HTMLSpanElement `- html элемент, отвечающий за отображение порядкового номера в корзине
- `buttonDelCard: HTMLButtonElement `- иконка корзины, по клику на которую удаляется соответствующая карточка.

Методы:

- `set index(value: number): void `- записывает порядковый номер карточки в корзине.

#### Класс `CardPreview`

Расширяет класс CardCatalog. Служит для предварительного просмотра карточки товара с более детальным описанием и возможностью добавления его в корзину.

Поля:

- `protected _description: HTMLParagraphElement `- html элемент, отвечающий за отображение описания товара
- `protected buttonBuyDelete: HTMLButtonElement` - кнопка для покупки товара или удаления товара из корзины в случае, если он уже был добавлен в нее.

Методы, геттеры и сеттеры:

- `set description(value: string): void `- записвает описание товара
- `set priceCheck(value: boolean): void `- записывает булево значение для блокировки/разблокировки кнопки добавления в корзину, если в модальном окне открыт бесценный товар: true - блокирует кнопку, false - разблокирует кнопку
- `get priceCheck(): boolean `- возвращает булево значение для блокировки/разблокировки кнопки добавления в корзину
- `set state(value: boolean)` - устанавливает состояние кнопки

## Взаимодействие компонетов (Presenter)

Слой Presenter не выделяется в отдельные классы и будет реализован в index.ts
